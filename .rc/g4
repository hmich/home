g4_commands=`g4 help commands | awk 'NF>3 {print $1}'`

function complete_g4 {
  local cmd=1
  while true; do
    case ${COMP_WORDS[$cmd]} in
	-G | -s | -??*)  let cmd++ ;;
	-?)  let cmd+=2 ;;
	*)   break ;;
    esac
  done

  if [ $COMP_CWORD = $cmd ] ; then
    COMPREPLY=(`compgen -W "$g4_commands" $2`)
  elif [ $COMP_CWORD -gt $cmd ] ; then
    COMPREPLY=(`compgen -f $2`)
  fi
  }

complete -F complete_g4 g4
